Document Request Automation System (Detailed Design w/ Upstage + n8n Integration)This document provides a concrete execution plan for automating the inter-departmental document information request and transfer process using the Upstage Document Parse API and the n8n automation engine.1. System GoalTo shorten the document request processing time and minimize the manual search and access verification steps for the receiving department's staff, enabling them to complete information sharing with a final single-click Approve action. (Using Email Notifications and Dedicated Web Links instead of Slack Integration)2. Core ComponentsComponentRoleDetailsA. Upstage Document Parse APIDocument Processing & Text ExtractionProcesses various formats (PDF, DOCX, XLSX) to extract text, tables, and structural information, making documents searchable.B. n8n Automation EngineWorkflow Control & IntegrationExecutes all core logic, including request reception, API calls, data processing, conditional branching, and notification delivery.C. Database (PostgreSQL)Document and Request StorageStores the parsed_text (Search Index) extracted by Upstage and the document_requests logs.D. Email & Dedicated Web FormRequest Initiation & Approval InterfaceUses a simple web form for the requester to submit information, and email to provide the approver with notification and Approve/Reject links.3. Detailed n8n WorkflowsWorkflow 1: Document Indexing (Pre-processing Pipeline)This workflow is automatically triggered when a new document is uploaded to the Document Management System (DMS) to build the search index.$$Trigger$$New Document Upload Detection: (e.g., Webhook from SharePoint, Google Drive, or File Server)$$HTTP Request$$Call Upstage Document Parse API:Endpoint: https://api.upstage.ai/v1/document-ai/document-parseSends the document file as the POST request body (formData).$$Function$$Parse Result Processing:Organizes the extracted fullText, pages, tables, and metadata from the API response.$$Database$$Store Document Information:Saves the Document ID, file path, extracted text (parsed_text), metadata, and access permission details to the documents table.Workflow 2: Document Request Processing (Main Process)$$Webhook$$Receive Dedicated Web Form Submission: Receives data (requester email, keyword) submitted via the simple web form.$$Set$$Parse Request Information: Stores the requester's email, department, keyword, and urgency in variables.$$HTTP Request / DB Query$$Document Search:Uses the keyword to perform a similarity search or text matching against the parsed_text field in the database.$$Function$$Permission Filtering and Approver Email Verification:Filters the search results to include only documents accessible based on the Approver's email address.$$IF$$Document Found Status:YES: Proceed to Step 6 (Approval Process).NO: Send a "Document Not Found" email notification immediately to the requester and terminate.$$Database$$Store Request Log:Generates a request_id and stores the status as "pending" in the document_requests table.$$Email$$Send Notification to Approver:Sends an alert to the Approver's email address.The email body includes the request details, a list of matching documents, and dedicated $$ ✅ Approve Webhook URL $$ and $$ ❌ Reject Webhook URL $$ links.Workflow 3: Approval Processing (Webhook Listener)$$Webhook$$Receive Approve/Reject Link Click: Receives the Request ID and Action (Approve/Reject) from the link clicked in the email.$$IF$$Check Action Type:Approve:$$HTTP Request$$Generate Document Sharing Link: Creates a one-time or permission-granted sharing link from the DMS for the requester.$$Email$$Notify Requester: Sends the final completion notification along with the document link.$$Database$$Update Status: Changes the document_requests status to "approved".Reject:$$Web Form Redirect$$Redirect to Rejection Reason Form: Redirects the approver to a simple web form to input the reason.$$Email$$Notify Requester: Sends the notification along with the rejection reason.$$Database$$Update Status: Changes the document_requests status to "rejected".4. Database Schemadocuments TableColumn NameTypeDescriptionidUUID PRIMARY KEYUnique Document IDfile_nameVARCHAROriginal File Namefile_pathTEXTPath to the Original Fileparsed_textTEXTFull text extracted by Upstage (Search Target)parsed_metadataJSONBParsing result metadata (page count, table info, etc.)access_levelVARCHARDocument security level (public, department, restricted)allowed_departmentsTEXT[]List of accessible departments (for permission filtering)Index: CREATE INDEX idx_documents_text ON documents USING gin(to_tsvector('korean', parsed_text));document_requests TableColumn NameTypeDescriptionidUUID PRIMARY KEYRequest Log IDrequester_emailVARCHARRequester's Email AddresskeywordTEXTSearch keyword used in the requestapprover_emailVARCHARApprover's Email AddressstatusVARCHARRequest status (pending, approved, rejected)approved_document_idUUIDFinal approved document ID (FK to documents table)rejection_reasonTEXTReason for rejection5. Initial Implementation Phases (Focus on Phase 1)n8n and DB Infrastructure Setup: Configure the n8n environment and set up the PostgreSQL/Supabase DB.Upstage API Integration Test: Obtain the Upstage API key and complete a test of parsing a simple PDF file using the n8n HTTP Request node.Web Form and SMTP Configuration: Set up a simple web form environment for request submission and configure SMTP settings for notification delivery (email sending).